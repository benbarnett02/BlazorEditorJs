/**
 * Minified by jsDelivr using Terser v5.15.1.
 * Original file: /npm/@editorjs/attaches@1.3.0/dev/server.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const http=require("http"),formidable=require("formidable"),crypto=require("crypto");class ServerExample{constructor({port:e,fieldName:o}){this.uploadDir=__dirname+"/.tmp",this.fieldName=o,this.server=http.createServer(((e,o)=>{this.onRequest(e,o)})).listen(e),this.server.on("listening",(()=>{console.log("Server is listening "+e+"...")})),this.server.on("error",(e=>{console.log("Failed to run server",e)}))}onRequest(e,o){this.allowCors(o);const{method:s,url:t}=e;if("post"===s.toLowerCase()){if(console.log("Got request on the ",t),"/uploadFile"===t)this.uploadFile(e,o)}else o.end()}allowCors(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Credentials","true"),e.setHeader("Access-Control-Allow-Methods","GET,HEAD,OPTIONS,POST,PUT"),e.setHeader("Access-Control-Allow-Headers","Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers")}uploadFile(e,o){let s={success:0};this.getForm(e).then((({files:e})=>{let o=e[this.fieldName]||{};s.success=1,s.file={url:o.path,name:o.name,size:o.size}})).catch((e=>{console.log("Uploading error",e)})).finally((()=>{o.writeHead(200,{"Content-Type":"application/json"}),o.end(JSON.stringify(s))}))}getForm(e){return new Promise(((o,s)=>{const t=new formidable.IncomingForm;t.uploadDir=this.uploadDir,t.keepExtensions=!0,t.parse(e,((e,t,r)=>{e?s(e):(console.log("fields",t),console.log("files",r),o({files:r,fields:t}))}))}))}md5(e){return crypto.createHash("md5").update(e).digest("hex")}}new ServerExample({port:8008,fieldName:"file"});
//# sourceMappingURL=/sm/36ceaae641018e8d82d6efb4d13d2a6a3e2e885c6eb3014444d839bc4cfd393f.map